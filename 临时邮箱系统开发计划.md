# 临时邮箱系统开发计划

## 项目概述

临时邮箱系统开发计划，基于Go + Gin后端和Vue3 + Ant Design前端的全栈项目。本计划采用MVP驱动开发策略，分阶段实现功能，确保每个阶段都能产出可运行的版本。

## 开发策略

- **MVP优先**：优先实现核心功能，快速验证产品可行性
- **分层开发**：按架构分层逐步完善，便于团队协作
- **测试驱动**：关键功能同步编写测试，保证代码质量
- **持续集成**：每个阶段完成后都能独立部署和测试

## 开发阶段规划

### 阶段一：基础架构搭建 🔄 **后端完成，前端未开始** *(2024-12-12)*

#### 目标
搭建项目骨架，配置开发环境，建立基础数据模型

#### 后端任务

**1.1 项目初始化** ✅
- [x] 创建项目目录结构
- [x] 初始化Go模块（`go mod init`）
- [x] 配置基础依赖包（Gin、GORM、Viper等）
- [ ] 创建Dockerfile和docker-compose.yml
- [ ] 配置热重载（Air）

**1.2 配置管理** ✅
- [x] 实现Viper配置管理
- [x] 创建多环境配置文件（.env.dev）
- [x] 配置数据库连接抽象（支持SQLite/PostgreSQL）
- [x] 实现配置验证和加载逻辑

**1.3 数据库设计** ✅
- [x] 设计数据库表结构（用户表已完成）
- [x] 创建GORM模型定义
- [x] 实现数据库迁移管理
- [ ] 创建种子数据脚本

**1.4 基础架构** ✅
- [x] 实现分层架构目录结构
- [x] 创建基础接口定义（Repository、Service）
- [x] 实现错误处理和日志系统
- [x] 配置CORS和基础中间件

#### 前端任务

**1.5 前端项目初始化** ⏳ **暂缓**
- [ ] 创建Vue3 + Vite项目
- [ ] 配置TypeScript
- [ ] 集成Ant Design Vue
- [ ] 配置Vue Router和Pinia
- [ ] 创建基础项目结构

**1.6 开发环境配置** ⏳ **暂缓**
- [ ] 配置代理设置（连接后端API）
- [ ] 创建基础布局组件
- [ ] 实现路由配置
- [ ] 配置Axios HTTP客户端

#### 验收标准
- [x] 后端服务能正常启动
- [x] 数据库连接和迁移正常
- [x] 基础API能正常访问
- [ ] Docker环境能正常启动 ⚠️ **待完成**
- [ ] 前后端能正常通信 ⚠️ **待完成**

---

### 阶段二：用户系统实现 🔄 **后端完成，前端未开始** *(2024-12-12)*

#### 目标
实现完整的用户注册、登录、认证系统

#### 后端任务

**2.1 用户模型和仓储** ✅
- [x] 完善User模型定义
- [x] 实现用户仓储接口和GORM实现
- [x] 添加密码加密功能（bcrypt）
- [x] 实现用户数据验证

**2.2 认证系统** ✅
- [x] 实现JWT token生成和验证
- [x] 创建认证中间件
- [x] 实现用户注册API
- [x] 实现用户登录API
- [ ] 实现JWT token刷新机制 ⏳ **待完成**

**2.3 用户管理API** ✅
- [x] 实现获取用户信息API
- [x] 实现用户信息更新API
- [x] 实现密码修改API
- [x] 添加API参数验证

#### 前端任务

**2.4 认证页面** ⏳ **暂缓**
- [ ] 创建登录页面组件
- [ ] 创建注册页面组件
- [ ] 实现表单验证
- [ ] 集成登录/注册API

**2.5 状态管理** ⏳ **暂缓**
- [ ] 创建用户状态store（Pinia）
- [ ] 实现登录状态持久化
- [ ] 创建路由守卫（认证检查）
- [ ] 实现自动token刷新

**2.6 用户界面** ⏳ **暂缓**
- [ ] 创建用户信息页面
- [ ] 实现用户信息编辑功能
- [ ] 创建密码修改功能
- [ ] 实现退出登录功能

#### 验收标准
- [x] 用户能正常注册和登录 ✅ **后端API已验证**
- [x] JWT认证正常工作 ✅ **后端已验证**
- [x] 用户信息能正常显示和修改 ✅ **后端已验证**
- [x] 集成测试全部通过 ✅ **后端已验证**
- [ ] 前端路由守卫生效 ⚠️ **前端未开始**

#### 已完成功能详细列表 ✅

**核心组件已实现：**
- ✅ **数据库层**: `connection.go`, `migrations.go` - 支持SQLite/PostgreSQL
- ✅ **认证层**: `password.go`, `jwt.go` - bcrypt密码哈希，JWT认证
- ✅ **数据访问层**: `user_repository.go` - 完整CRUD操作
- ✅ **业务逻辑层**: `user_service.go` - 用户注册、登录、资料管理
- ✅ **中间件层**: `auth.go` - JWT认证、CORS、请求ID中间件
- ✅ **API层**: `user_handler.go` - HTTP端点处理
- ✅ **服务器**: `main.go` - 服务集成和启动

**测试覆盖：**
- ✅ **单元测试**: `password_test.go`, `connection_test.go` - 核心功能测试
- ✅ **集成测试**: `integration_test.go` - 端到端流程验证

**API端点已验证：**
- ✅ `POST /api/v1/auth/register` - 用户注册
- ✅ `POST /api/v1/auth/login` - 用户登录  
- ✅ `GET /api/v1/users/profile` - 获取用户资料
- ✅ `PUT /api/v1/users/profile` - 更新用户资料
- ✅ `PUT /api/v1/users/password` - 修改密码
- ✅ `GET /health` - 健康检查

---

### 阶段2.5：前端用户系统开发 🎯 **明天开始** *(计划2024-12-13)*

#### 目标
为现有后端用户管理API开发对应的前端界面，实现完整的用户系统

#### 前端开发任务

**2.5.1 项目初始化和环境配置** 
- [ ] 创建Vue3 + Vite项目
- [ ] 配置TypeScript支持
- [ ] 集成Ant Design Vue组件库
- [ ] 配置Vue Router路由
- [ ] 配置Pinia状态管理
- [ ] 配置Axios HTTP客户端
- [ ] 设置代理连接后端API (localhost:8080)
- [ ] 配置环境变量管理

**2.5.2 基础布局和组件**
- [ ] 创建主布局组件 (MainLayout.vue)
- [ ] 实现顶部导航栏 (Header.vue)
- [ ] 实现侧边栏菜单 (Sidebar.vue)
- [ ] 创建加载组件 (Loading.vue)
- [ ] 实现通用按钮和表单组件
- [ ] 配置全局样式和主题

**2.5.3 用户认证页面**
- [ ] 创建登录页面 (Login.vue)
  - 邮箱/密码表单
  - 表单验证
  - 调用 `POST /api/v1/auth/login` API
  - 登录成功后跳转到dashboard
- [ ] 创建注册页面 (Register.vue)  
  - 用户名、邮箱、密码、姓名表单
  - 密码确认和强度验证
  - 调用 `POST /api/v1/auth/register` API
  - 注册成功后自动登录

**2.5.4 用户状态管理**
- [ ] 创建用户状态store (stores/auth.ts)
  - 用户信息存储
  - 登录状态管理
  - JWT token管理
  - 自动登录/登出逻辑
- [ ] 实现token自动刷新机制
- [ ] 实现本地存储持久化
- [ ] 实现API请求拦截器

**2.5.5 用户资料管理页面**
- [ ] 创建用户资料页面 (Profile.vue)
  - 显示用户基本信息
  - 调用 `GET /api/v1/users/profile` API
- [ ] 创建资料编辑页面 (EditProfile.vue)
  - 编辑姓名、头像、时区、语言
  - 调用 `PUT /api/v1/users/profile` API
  - 表单验证和成功提示
- [ ] 创建密码修改页面 (ChangePassword.vue)
  - 当前密码、新密码表单
  - 密码强度验证
  - 调用 `PUT /api/v1/users/password` API

**2.5.6 路由和权限控制**
- [ ] 配置路由表 (router/index.ts)
  - 公开路由：登录、注册
  - 受保护路由：dashboard、资料管理
- [ ] 实现路由守卫
  - 检查登录状态
  - 未登录自动跳转到登录页
  - 已登录不能访问登录/注册页
- [ ] 实现页面权限控制

**2.5.7 Dashboard主页**
- [ ] 创建仪表板页面 (Dashboard.vue)
  - 欢迎信息显示
  - 用户快速操作区域
  - 预留域名和邮箱管理入口
- [ ] 实现用户信息卡片
- [ ] 添加快速导航功能

**2.5.8 API集成和错误处理**
- [ ] 创建API服务层 (api/auth.ts)
  - 登录API接口
  - 注册API接口
  - 用户资料API接口
  - 密码修改API接口
- [ ] 实现统一错误处理
- [ ] 添加加载状态管理
- [ ] 实现成功/错误消息提示

**2.5.9 样式和用户体验**
- [ ] 实现响应式设计
- [ ] 添加页面切换动画
- [ ] 优化表单用户体验
- [ ] 实现深色/浅色主题切换
- [ ] 添加多语言支持基础

**2.5.10 测试和部署**
- [ ] 编写组件单元测试
- [ ] 进行前后端集成测试
- [ ] 配置前端打包构建
- [ ] 配置开发热重载
- [ ] 优化构建产物大小

#### 对应的后端API端点
- ✅ `POST /api/v1/auth/register` - 用户注册
- ✅ `POST /api/v1/auth/login` - 用户登录  
- ✅ `GET /api/v1/users/profile` - 获取用户资料
- ✅ `PUT /api/v1/users/profile` - 更新用户资料
- ✅ `PUT /api/v1/users/password` - 修改密码
- ✅ `GET /health` - 健康检查

#### 技术栈
- **框架**: Vue 3 + Composition API
- **构建工具**: Vite
- **语言**: TypeScript
- **UI库**: Ant Design Vue
- **路由**: Vue Router 4
- **状态管理**: Pinia
- **HTTP客户端**: Axios
- **样式**: CSS3 + Ant Design主题

#### 验收标准
- [ ] 用户能在前端页面正常注册
- [ ] 用户能在前端页面正常登录
- [ ] 登录后能查看和编辑个人资料
- [ ] 能正常修改密码
- [ ] 路由守卫正常工作
- [ ] 前后端数据交互无错误
- [ ] 界面美观、响应式良好
- [ ] 用户体验流畅

#### 预估时间
- **项目搭建**: 0.5天
- **基础组件**: 1天  
- **认证页面**: 1天
- **资料管理**: 1天
- **集成测试**: 0.5天
- **总计**: 约4天

---

### 阶段三：域名管理系统 ⏳ **计划中**

#### 目标
实现DNS域名管理功能，集成Cloudflare API

#### 后端任务

**3.1 域名模型和仓储**
- [ ] 创建Domain模型
- [ ] 实现域名仓储接口和实现
- [ ] 添加域名验证规则
- [ ] 实现域名状态管理

**3.2 Cloudflare集成**
- [ ] 集成Cloudflare SDK
- [ ] 实现DNS记录管理
- [ ] 实现MX记录自动配置
- [ ] 创建域名验证服务

**3.3 域名管理API**
- [ ] 实现添加域名API
- [ ] 实现域名列表查询API
- [ ] 实现域名删除API
- [ ] 实现域名状态查询API

#### 前端任务

**3.4 域名管理界面**
- [ ] 创建域名列表页面
- [ ] 创建添加域名表单
- [ ] 实现域名状态显示
- [ ] 创建域名删除确认对话框

**3.5 域名状态管理**
- [ ] 创建域名状态store
- [ ] 实现域名数据的CRUD操作
- [ ] 添加域名验证状态显示
- [ ] 实现域名列表刷新功能

#### 验收标准
- [ ] 能正常添加和删除域名
- [ ] Cloudflare DNS记录能自动配置
- [ ] 域名状态能正确显示
- [ ] 前端界面友好易用

---

### 阶段四：临时邮箱管理 ⏳ **计划中**

#### 目标
实现临时邮箱的创建、管理和生命周期控制

#### 后端任务

**4.1 邮箱模型和仓储**
- [ ] 创建TemporaryEmail模型
- [ ] 实现邮箱仓储接口和实现
- [ ] 添加邮箱有效期管理
- [ ] 实现邮箱唯一性验证

**4.2 邮箱管理服务**
- [ ] 实现邮箱创建服务
- [ ] 实现邮箱生命周期管理
- [ ] 创建邮箱过期检查后台任务
- [ ] 实现软删除机制

**4.3 邮箱管理API**
- [ ] 实现创建临时邮箱API
- [ ] 实现邮箱列表查询API
- [ ] 实现邮箱详情查询API
- [ ] 实现邮箱删除API

#### 前端任务

**4.4 邮箱管理界面**
- [ ] 创建邮箱列表页面
- [ ] 创建新建邮箱表单
- [ ] 实现邮箱状态显示（有效/过期）
- [ ] 创建邮箱详情页面

**4.5 邮箱状态管理**
- [ ] 创建邮箱状态store
- [ ] 实现邮箱的CRUD操作
- [ ] 添加邮箱过期时间倒计时
- [ ] 实现邮箱列表实时更新

#### 验收标准
- [ ] 能正常创建临时邮箱
- [ ] 邮箱有效期管理正常
- [ ] 过期邮箱能自动标记和处理
- [ ] 前端能实时显示邮箱状态

---

### 阶段五：SMTP邮件服务 ⏳ **计划中**

#### 目标
集成go-guerrilla SMTP服务，实现邮件接收和存储

#### 后端任务

**5.1 SMTP服务集成**
- [ ] 集成go-guerrilla SMTP服务器
- [ ] 配置SMTP服务器设置
- [ ] 实现动态域名管理
- [ ] 创建SMTP服务健康检查

**5.2 邮件模型和存储**
- [ ] 创建Message模型
- [ ] 实现邮件仓储接口和实现
- [ ] 实现邮件解析和存储逻辑
- [ ] 添加邮件附件处理（基础版本）

**5.3 邮件处理服务**
- [ ] 实现邮件接收处理器
- [ ] 创建邮件有效性验证
- [ ] 实现邮件与临时邮箱关联
- [ ] 创建邮件清理后台任务

**5.4 邮件查询API**
- [ ] 实现邮件列表查询API
- [ ] 实现邮件详情查询API
- [ ] 实现邮件删除API
- [ ] 添加邮件搜索功能

#### 前端任务

**5.5 邮件管理界面**
- [ ] 创建邮件列表页面
- [ ] 创建邮件详情页面
- [ ] 实现邮件内容显示
- [ ] 添加邮件操作功能（删除等）

**5.6 邮件状态管理**
- [ ] 创建邮件状态store
- [ ] 实现邮件数据加载和缓存
- [ ] 添加邮件实时更新功能
- [ ] 实现邮件搜索功能

#### 验收标准
- [ ] SMTP服务能正常接收邮件
- [ ] 邮件能正确解析和存储
- [ ] 前端能正常显示和管理邮件
- [ ] 邮件与临时邮箱正确关联

---

### 阶段六：后台任务系统 ⏳ **计划中**

#### 目标
实现系统后台任务，包括定期清理、状态检查等

#### 后端任务

**6.1 任务调度系统**
- [ ] 集成Cron任务调度器
- [ ] 创建任务基础接口
- [ ] 实现任务状态监控
- [ ] 添加任务执行日志

**6.2 系统维护任务**
- [ ] 实现MX记录验证任务
- [ ] 创建邮箱过期检查任务
- [ ] 实现邮件清理任务
- [ ] 创建系统健康检查任务

**6.3 任务管理API**
- [ ] 实现任务状态查询API
- [ ] 创建手动触发任务API
- [ ] 实现任务执行历史查询
- [ ] 添加任务配置管理

#### 验收标准
- [ ] 后台任务能正常调度执行
- [ ] 过期数据能自动清理
- [ ] 系统状态能实时监控
- [ ] 任务执行状态可查询

---

### 阶段七：系统集成和优化 ⏳ **计划中**

#### 目标
完善系统功能，优化性能，准备生产部署

#### 系统优化任务

**7.1 性能优化**
- [ ] 数据库查询优化
- [ ] 添加Redis缓存（可选）
- [ ] 实现API响应缓存
- [ ] 优化前端资源加载

**7.2 安全加固**
- [ ] 实现API访问频率限制
- [ ] 添加CSRF保护
- [ ] 完善输入验证和过滤
- [ ] 实现安全日志记录

**7.3 监控和日志**
- [ ] 完善应用日志系统
- [ ] 实现错误监控和告警
- [ ] 添加性能监控指标
- [ ] 创建健康检查端点

**7.4 文档和测试**
- [ ] 完善API文档
- [ ] 编写关键功能测试
- [ ] 创建部署文档
- [ ] 编写用户使用手册

#### 验收标准
- [ ] 系统性能满足预期要求
- [ ] 安全措施完备
- [ ] 监控和日志完善
- [ ] 文档齐全

---

### 阶段八：部署和上线 ⏳ **计划中**

#### 目标
配置生产环境，完成系统部署上线

#### 部署任务

**8.1 生产环境配置**
- [ ] 配置生产数据库（PostgreSQL）
- [ ] 设置SSL证书（Let's Encrypt）
- [ ] 配置Nginx反向代理
- [ ] 设置防火墙和安全组

**8.2 应用部署**
- [ ] 构建生产版本镜像
- [ ] 配置docker-compose生产环境
- [ ] 执行数据库迁移
- [ ] 启动生产服务

**8.3 监控和维护**
- [ ] 配置服务监控
- [ ] 设置日志收集
- [ ] 创建数据备份策略
- [ ] 制定运维手册

#### 验收标准
- [ ] 生产环境正常运行
- [ ] 所有功能正常工作
- [ ] 监控和告警正常
- [ ] 数据备份策略生效

---

## 开发里程碑

| 阶段 | 关键里程碑 | 状态 | 完成时间 |
|------|------------|------|----------|
| 阶段一：基础架构 | 项目框架搭建完成 | 🔄 **后端完成** | 2024-12-12 |
| 阶段二：用户系统 | 用户注册登录完成 | 🔄 **后端完成** | 2024-12-12 |
| 阶段2.5：前端用户系统 | 前端用户界面完成 | 🎯 **明天开始** | 计划2024-12-17 |
| 阶段三：域名管理 | DNS管理功能完成 | ⏳ **计划中** | - |
| 阶段四：邮箱管理 | 临时邮箱功能完成 | ⏳ **计划中** | - |
| 阶段五：SMTP服务 | 邮件收发功能完成 | ⏳ **计划中** | - |
| 阶段六：后台任务 | 系统维护任务完成 | ⏳ **计划中** | - |
| 阶段七：集成优化 | 系统优化完成 | ⏳ **计划中** | - |
| 阶段八：部署上线 | 生产环境上线 | ⏳ **计划中** | - |

## 当前项目状态总结 (2024-12-12更新)

### ✅ 后端已完成功能
1. **完整的用户管理系统（后端）**
   - 用户注册、登录、资料管理API
   - JWT认证和中间件
   - 密码加密和验证
   - 完整的HTTP端点和错误处理

2. **稳定的基础架构（后端）**
   - 分层架构设计
   - 数据库连接和迁移
   - 配置管理系统
   - 中间件和路由管理

3. **完善的测试体系（后端）**
   - 单元测试覆盖核心功能
   - 集成测试验证端到端流程
   - 所有后端测试通过验证

### ⚠️ 待完成功能
1. **前端系统（0%完成）**
   - Vue3 + Vite项目创建
   - 用户界面（登录、注册、资料管理）
   - 状态管理（Pinia）
   - 路由和认证守卫

2. **开发环境完善**
   - Docker环境配置
   - 前后端集成测试
   - 热重载配置

### 🚀 技术亮点
- **数据库抽象**: 支持SQLite和PostgreSQL无缝切换
- **安全性**: bcrypt密码哈希 + JWT认证
- **可测试性**: 依赖注入 + 接口抽象设计
- **可维护性**: 清晰的分层架构和代码组织

### 📋 下一步计划 (已确定)
1. **🎯 明天开始**: 阶段2.5前端用户系统开发
   - 创建Vue3 + Vite + TypeScript项目
   - 集成Ant Design Vue组件库
   - 实现登录/注册/资料管理页面
   - 完成前后端API集成
   - 实现路由守卫和状态管理
   - **预估4天完成**

2. **后续计划**: 前端完成后继续域名管理系统
   - 开始阶段三域名管理后端开发  
   - 并行开发域名管理前端界面
   - 实现完整的域名+邮箱管理功能

## 开发注意事项

### 技术要点
1. **数据库设计**：注意表之间的关联关系，设计合理的索引
2. **SMTP集成**：go-guerrilla配置较复杂，需要仔细调试
3. **前端状态管理**：合理设计Pinia store，避免状态混乱
4. **错误处理**：统一错误码和错误处理机制

### 开发建议
1. **版本控制**：每个阶段完成后及时提交代码，打上版本标签
2. **测试策略**：关键功能同步编写测试，保证代码质量
3. **文档更新**：开发过程中及时更新技术文档
4. **代码审查**：重要功能完成后进行代码审查

### 风险控制
1. **技术风险**：SMTP服务集成可能遇到困难，需要预留调试时间
2. **进度风险**：如果某个阶段延期，可以适当调整后续计划
3. **质量风险**：不要为了赶进度忽视代码质量和测试

---

## 项目目录结构

基于我们确定的技术栈和功能需求，推荐以下项目目录结构：

```
temp-mailbox-service/
├── README.md                          # 项目说明文档
├── .gitignore                        # Git忽略文件配置
├── .env.example                      # 环境变量模板
├── docker-compose.dev.yml            # 开发环境Docker配置
├── docker-compose.prod.yml           # 生产环境Docker配置
├── Makefile                          # 项目构建和管理命令
│
├── backend/                          # 后端Go项目
│   ├── cmd/                          # 应用程序入口
│   │   ├── server/                   # HTTP服务器
│   │   │   └── main.go               # ✅ 已实现
│   │   └── worker/                   # 后台任务程序
│   │       └── main.go
│   │
│   ├── internal/                     # 内部包（不对外暴露）
│   │   ├── api/                      # API层
│   │   │   └── user_handler.go       # ✅ 已实现
│   │   │
│   │   ├── application/              # 应用层  
│   │   │   └── user_service.go       # ✅ 已实现
│   │   │
│   │   ├── domain/                   # 领域层
│   │   │   └── user/                 # ✅ 已实现
│   │   │       ├── models.go
│   │   │       └── repository.go
│   │   │
│   │   └── infrastructure/           # 基础设施层
│   │       ├── auth/                 # ✅ 已实现
│   │       │   ├── jwt.go
│   │       │   └── password.go
│   │       ├── config/               # ✅ 已实现
│   │       │   └── config.go
│   │       ├── database/             # ✅ 已实现
│   │       │   ├── connection.go
│   │       │   └── migrations.go
│   │       ├── middleware/           # ✅ 已实现
│   │       │   └── auth.go
│   │       └── persistence/          # ✅ 已实现
│   │           └── user_repository.go
│   │
│   ├── .env.dev                      # ✅ 已配置
│   ├── go.mod                        # ✅ 已配置
│   ├── go.sum                        # ✅ 已配置
│   └── 各种测试文件                   # ✅ 已实现
│
├── frontend/                         # ⏳ 前端Vue项目（计划中）
│
├── docs/                            # 项目文档
│   ├── 临时邮箱系统开发计划.md         # ✅ 本文档
│   └── 开发文档.md                   # ✅ 已存在
│
└── 其他配置文件...
```

### 当前实现状态
- ✅ **后端核心架构**: 100%完成
- 🔄 **用户管理系统**: 后端100%，前端0%
- ✅ **后端测试体系**: 基础测试完成
- ❌ **前端系统**: 0%（急需开始）
- ⏳ **域名管理**: 0%（后续阶段）
- ⏳ **邮件系统**: 0%（后续阶段）
- ❌ **Docker环境**: 未配置
- ❌ **前后端集成**: 未完成

---

**最后更新**: 2024年12月12日  
**当前状态**: 阶段二用户系统开发完成，准备进入阶段三域名管理系统开发 