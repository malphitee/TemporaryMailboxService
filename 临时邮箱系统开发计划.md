# 临时邮箱系统开发计划

## 项目概述

临时邮箱系统开发计划，基于Go + Gin后端和Vue3 + Ant Design前端的全栈项目。本计划采用MVP驱动开发策略，分阶段实现功能，确保每个阶段都能产出可运行的版本。

## 开发策略

- **MVP优先**：优先实现核心功能，快速验证产品可行性
- **分层开发**：按架构分层逐步完善，便于团队协作
- **测试驱动**：关键功能同步编写测试，保证代码质量
- **持续集成**：每个阶段完成后都能独立部署和测试

## 开发阶段规划

### 阶段一：基础架构搭建

#### 目标
搭建项目骨架，配置开发环境，建立基础数据模型

#### 后端任务

**1.1 项目初始化**
- [ ] 创建项目目录结构
- [ ] 初始化Go模块（`go mod init`）
- [ ] 配置基础依赖包（Gin、GORM、Viper等）
- [ ] 创建Dockerfile和docker-compose.yml
- [ ] 配置热重载（Air）

**1.2 配置管理**
- [ ] 实现Viper配置管理
- [ ] 创建多环境配置文件（.env.dev, .env.production）
- [ ] 配置数据库连接抽象（支持SQLite/PostgreSQL）
- [ ] 实现配置验证和加载逻辑

**1.3 数据库设计**
- [ ] 设计数据库表结构（用户、域名、邮箱、邮件）
- [ ] 创建GORM模型定义
- [ ] 实现数据库迁移管理
- [ ] 创建种子数据脚本

**1.4 基础架构**
- [ ] 实现分层架构目录结构
- [ ] 创建基础接口定义（Repository、Service）
- [ ] 实现错误处理和日志系统
- [ ] 配置CORS和基础中间件

#### 前端任务

**1.5 前端项目初始化**
- [ ] 创建Vue3 + Vite项目
- [ ] 配置TypeScript
- [ ] 集成Ant Design Vue
- [ ] 配置Vue Router和Pinia
- [ ] 创建基础项目结构

**1.6 开发环境配置**
- [ ] 配置代理设置（连接后端API）
- [ ] 创建基础布局组件
- [ ] 实现路由配置
- [ ] 配置Axios HTTP客户端

#### 验收标准
- [ ] Docker环境能正常启动
- [ ] 前后端能正常通信
- [ ] 数据库连接和迁移正常
- [ ] 基础页面能正常访问

---

### 阶段二：用户系统实现

#### 目标
实现完整的用户注册、登录、认证系统

#### 后端任务

**2.1 用户模型和仓储**
- [ ] 完善User模型定义
- [ ] 实现用户仓储接口和GORM实现
- [ ] 添加密码加密功能（bcrypt）
- [ ] 实现用户数据验证

**2.2 认证系统**
- [ ] 实现JWT token生成和验证
- [ ] 创建认证中间件
- [ ] 实现用户注册API
- [ ] 实现用户登录API
- [ ] 实现JWT token刷新机制

**2.3 用户管理API**
- [ ] 实现获取用户信息API
- [ ] 实现用户信息更新API
- [ ] 实现密码修改API
- [ ] 添加API参数验证

#### 前端任务

**2.4 认证页面**
- [ ] 创建登录页面组件
- [ ] 创建注册页面组件
- [ ] 实现表单验证
- [ ] 集成登录/注册API

**2.5 状态管理**
- [ ] 创建用户状态store（Pinia）
- [ ] 实现登录状态持久化
- [ ] 创建路由守卫（认证检查）
- [ ] 实现自动token刷新

**2.6 用户界面**
- [ ] 创建用户信息页面
- [ ] 实现用户信息编辑功能
- [ ] 创建密码修改功能
- [ ] 实现退出登录功能

#### 验收标准
- [ ] 用户能正常注册和登录
- [ ] JWT认证正常工作
- [ ] 前端路由守卫生效
- [ ] 用户信息能正常显示和修改

---

### 阶段三：域名管理系统

#### 目标
实现DNS域名管理功能，集成Cloudflare API

#### 后端任务

**3.1 域名模型和仓储**
- [ ] 创建Domain模型
- [ ] 实现域名仓储接口和实现
- [ ] 添加域名验证规则
- [ ] 实现域名状态管理

**3.2 Cloudflare集成**
- [ ] 集成Cloudflare SDK
- [ ] 实现DNS记录管理
- [ ] 实现MX记录自动配置
- [ ] 创建域名验证服务

**3.3 域名管理API**
- [ ] 实现添加域名API
- [ ] 实现域名列表查询API
- [ ] 实现域名删除API
- [ ] 实现域名状态查询API

#### 前端任务

**3.4 域名管理界面**
- [ ] 创建域名列表页面
- [ ] 创建添加域名表单
- [ ] 实现域名状态显示
- [ ] 创建域名删除确认对话框

**3.5 域名状态管理**
- [ ] 创建域名状态store
- [ ] 实现域名数据的CRUD操作
- [ ] 添加域名验证状态显示
- [ ] 实现域名列表刷新功能

#### 验收标准
- [ ] 能正常添加和删除域名
- [ ] Cloudflare DNS记录能自动配置
- [ ] 域名状态能正确显示
- [ ] 前端界面友好易用

---

### 阶段四：临时邮箱管理

#### 目标
实现临时邮箱的创建、管理和生命周期控制

#### 后端任务

**4.1 邮箱模型和仓储**
- [ ] 创建TemporaryEmail模型
- [ ] 实现邮箱仓储接口和实现
- [ ] 添加邮箱有效期管理
-[ ] 实现邮箱唯一性验证

**4.2 邮箱管理服务**
- [ ] 实现邮箱创建服务
- [ ] 实现邮箱生命周期管理
- [ ] 创建邮箱过期检查后台任务
- [ ] 实现软删除机制

**4.3 邮箱管理API**
- [ ] 实现创建临时邮箱API
- [ ] 实现邮箱列表查询API
- [ ] 实现邮箱详情查询API
- [ ] 实现邮箱删除API

#### 前端任务

**4.4 邮箱管理界面**
- [ ] 创建邮箱列表页面
- [ ] 创建新建邮箱表单
- [ ] 实现邮箱状态显示（有效/过期）
- [ ] 创建邮箱详情页面

**4.5 邮箱状态管理**
- [ ] 创建邮箱状态store
- [ ] 实现邮箱的CRUD操作
- [ ] 添加邮箱过期时间倒计时
- [ ] 实现邮箱列表实时更新

#### 验收标准
- [ ] 能正常创建临时邮箱
- [ ] 邮箱有效期管理正常
- [ ] 过期邮箱能自动标记和处理
- [ ] 前端能实时显示邮箱状态

---

### 阶段五：SMTP邮件服务

#### 目标
集成go-guerrilla SMTP服务，实现邮件接收和存储

#### 后端任务

**5.1 SMTP服务集成**
- [ ] 集成go-guerrilla SMTP服务器
- [ ] 配置SMTP服务器设置
- [ ] 实现动态域名管理
- [ ] 创建SMTP服务健康检查

**5.2 邮件模型和存储**
- [ ] 创建Message模型
- [ ] 实现邮件仓储接口和实现
- [ ] 实现邮件解析和存储逻辑
- [ ] 添加邮件附件处理（基础版本）

**5.3 邮件处理服务**
- [ ] 实现邮件接收处理器
- [ ] 创建邮件有效性验证
- [ ] 实现邮件与临时邮箱关联
- [ ] 创建邮件清理后台任务

**5.4 邮件查询API**
- [ ] 实现邮件列表查询API
- [ ] 实现邮件详情查询API
- [ ] 实现邮件删除API
- [ ] 添加邮件搜索功能

#### 前端任务

**5.5 邮件管理界面**
- [ ] 创建邮件列表页面
- [ ] 创建邮件详情页面
- [ ] 实现邮件内容显示
- [ ] 添加邮件操作功能（删除等）

**5.6 邮件状态管理**
- [ ] 创建邮件状态store
- [ ] 实现邮件数据加载和缓存
- [ ] 添加邮件实时更新功能
- [ ] 实现邮件搜索功能

#### 验收标准
- [ ] SMTP服务能正常接收邮件
- [ ] 邮件能正确解析和存储
- [ ] 前端能正常显示和管理邮件
- [ ] 邮件与临时邮箱正确关联

---

### 阶段六：后台任务系统

#### 目标
实现系统后台任务，包括定期清理、状态检查等

#### 后端任务

**6.1 任务调度系统**
- [ ] 集成Cron任务调度器
- [ ] 创建任务基础接口
- [ ] 实现任务状态监控
- [ ] 添加任务执行日志

**6.2 系统维护任务**
- [ ] 实现MX记录验证任务
- [ ] 创建邮箱过期检查任务
- [ ] 实现邮件清理任务
- [ ] 创建系统健康检查任务

**6.3 任务管理API**
- [ ] 实现任务状态查询API
- [ ] 创建手动触发任务API
- [ ] 实现任务执行历史查询
- [ ] 添加任务配置管理

#### 验收标准
- [ ] 后台任务能正常调度执行
- [ ] 过期数据能自动清理
- [ ] 系统状态能实时监控
- [ ] 任务执行状态可查询

---

### 阶段七：系统集成和优化

#### 目标
完善系统功能，优化性能，准备生产部署

#### 系统优化任务

**7.1 性能优化**
- [ ] 数据库查询优化
- [ ] 添加Redis缓存（可选）
- [ ] 实现API响应缓存
- [ ] 优化前端资源加载

**7.2 安全加固**
- [ ] 实现API访问频率限制
- [ ] 添加CSRF保护
- [ ] 完善输入验证和过滤
- [ ] 实现安全日志记录

**7.3 监控和日志**
- [ ] 完善应用日志系统
- [ ] 实现错误监控和告警
- [ ] 添加性能监控指标
- [ ] 创建健康检查端点

**7.4 文档和测试**
- [ ] 完善API文档
- [ ] 编写关键功能测试
- [ ] 创建部署文档
- [ ] 编写用户使用手册

#### 验收标准
- [ ] 系统性能满足预期要求
- [ ] 安全措施完备
- [ ] 监控和日志完善
- [ ] 文档齐全

---

### 阶段八：部署和上线

#### 目标
配置生产环境，完成系统部署上线

#### 部署任务

**8.1 生产环境配置**
- [ ] 配置生产数据库（PostgreSQL）
- [ ] 设置SSL证书（Let's Encrypt）
- [ ] 配置Nginx反向代理
- [ ] 设置防火墙和安全组

**8.2 应用部署**
- [ ] 构建生产版本镜像
- [ ] 配置docker-compose生产环境
- [ ] 执行数据库迁移
- [ ] 启动生产服务

**8.3 监控和维护**
- [ ] 配置服务监控
- [ ] 设置日志收集
- [ ] 创建数据备份策略
- [ ] 制定运维手册

#### 验收标准
- [ ] 生产环境正常运行
- [ ] 所有功能正常工作
- [ ] 监控和告警正常
- [ ] 数据备份策略生效

---

## 开发里程碑

| 阶段 | 关键里程碑 |
|------|------------|
| 阶段一：基础架构 | 项目框架搭建完成 |
| 阶段二：用户系统 | 用户注册登录完成 |
| 阶段三：域名管理 | DNS管理功能完成 |
| 阶段四：邮箱管理 | 临时邮箱功能完成 |
| 阶段五：SMTP服务 | 邮件收发功能完成 |
| 阶段六：后台任务 | 系统维护任务完成 |
| 阶段七：集成优化 | 系统优化完成 |
| 阶段八：部署上线 | 生产环境上线 |

## 开发注意事项

### 技术要点
1. **数据库设计**：注意表之间的关联关系，设计合理的索引
2. **SMTP集成**：go-guerrilla配置较复杂，需要仔细调试
3. **前端状态管理**：合理设计Pinia store，避免状态混乱
4. **错误处理**：统一错误码和错误处理机制

### 开发建议
1. **版本控制**：每个阶段完成后及时提交代码，打上版本标签
2. **测试策略**：关键功能同步编写测试，保证代码质量
3. **文档更新**：开发过程中及时更新技术文档
4. **代码审查**：重要功能完成后进行代码审查

### 风险控制
1. **技术风险**：SMTP服务集成可能遇到困难，需要预留调试时间
2. **进度风险**：如果某个阶段延期，可以适当调整后续计划
3. **质量风险**：不要为了赶进度忽视代码质量和测试

---

## 项目目录结构

基于我们确定的技术栈和功能需求，推荐以下项目目录结构：

```
temp-mailbox-service/
├── README.md                          # 项目说明文档
├── .gitignore                        # Git忽略文件配置
├── .env.example                      # 环境变量模板
├── docker-compose.dev.yml            # 开发环境Docker配置
├── docker-compose.prod.yml           # 生产环境Docker配置
├── Makefile                          # 项目构建和管理命令
│
├── backend/                          # 后端Go项目
│   ├── cmd/                          # 应用程序入口
│   │   ├── server/                   # HTTP服务器
│   │   │   └── main.go
│   │   └── worker/                   # 后台任务程序
│   │       └── main.go
│   │
│   ├── internal/                     # 内部包（不对外暴露）
│   │   ├── api/                      # API层
│   │   │   ├── handlers/             # HTTP请求处理器
│   │   │   │   ├── auth.go
│   │   │   │   ├── domain.go
│   │   │   │   ├── email.go
│   │   │   │   └── message.go
│   │   │   ├── middleware/           # 中间件
│   │   │   │   ├── auth.go
│   │   │   │   ├── cors.go
│   │   │   │   └── logger.go
│   │   │   └── routes/               # 路由配置
│   │   │       └── routes.go
│   │   │
│   │   ├── domain/                   # 领域层
│   │   │   ├── entity/               # 实体
│   │   │   │   ├── user.go
│   │   │   │   ├── domain.go
│   │   │   │   ├── email.go
│   │   │   │   └── message.go
│   │   │   ├── repository/           # 仓储接口
│   │   │   │   ├── user.go
│   │   │   │   ├── domain.go
│   │   │   │   ├── email.go
│   │   │   │   └── message.go
│   │   │   └── service/              # 领域服务
│   │   │       ├── auth_service.go
│   │   │       ├── dns_service.go
│   │   │       ├── email_service.go
│   │   │       └── smtp_service.go
│   │   │
│   │   ├── infrastructure/           # 基础设施层
│   │   │   ├── database/             # 数据库基础设施层
│   │   │   │   ├── connection.go     # 数据库连接管理（GORM配置）
│   │   │   │   ├── models/           # GORM模型定义
│   │   │   │   │   ├── user.go
│   │   │   │   │   ├── domain.go
│   │   │   │   │   ├── email.go
│   │   │   │   │   ├── message.go
│   │   │   │   │   └── base.go
│   │   │   │   └── migrations/       # 数据库迁移
│   │   │   │       ├── migrate.go
│   │   │   │       └── 001_init_tables.go
│   │   │   ├── repository/           # 仓储实现
│   │   │   │   ├── gorm/             # GORM仓储实现（支持多数据库）
│   │   │   │   │   ├── user.go
│   │   │   │   │   ├── domain.go
│   │   │   │   │   ├── email.go
│   │   │   │   │   └── message.go
│   │   │   │   └── redis/            # Redis缓存实现
│   │   │   │       └── cache.go
│   │   │   ├── external/             # 外部服务
│   │   │   │   ├── cloudflare/       # Cloudflare DNS
│   │   │   │   │   └── dns.go
│   │   │   │   └── smtp/             # SMTP服务
│   │   │   │       └── guerrilla.go
│   │   │   └── config/               # 配置管理
│   │   │       ├── config.go         # 主配置
│   │   │       ├── database.go       # 数据库配置结构
│   │   │       └── validator.go      # 配置验证
│   │   │
│   │   ├── application/              # 应用层
│   │   │   ├── dto/                  # 数据传输对象
│   │   │   │   ├── auth.go
│   │   │   │   ├── domain.go
│   │   │   │   ├── email.go
│   │   │   │   └── message.go
│   │   │   └── usecase/              # 用例
│   │   │       ├── auth_usecase.go
│   │   │       ├── dns_usecase.go
│   │   │       ├── email_usecase.go
│   │   │       └── message_usecase.go
│   │   │
│   │   └── worker/                   # 后台任务
│   │       ├── jobs/                 # 任务定义
│   │       │   ├── mx_verifier.go
│   │       │   ├── email_cleaner.go
│   │       │   └── health_checker.go
│   │       └── scheduler/            # 任务调度
│   │           └── cron.go
│   │
│   ├── pkg/                          # 公共包（可对外暴露）
│   │   ├── utils/                    # 工具函数
│   │   │   ├── jwt.go
│   │   │   ├── validator.go
│   │   │   └── crypto.go
│   │   ├── logger/                   # 日志
│   │   │   └── logger.go
│   │   └── errors/                   # 错误处理
│   │       └── errors.go
│   │
│   ├── configs/                      # 配置文件
│   │   ├── .env.dev                  # 开发环境配置
│   │   ├── .env.production           # 生产环境配置
│   │   └── app.yaml                  # 应用配置模板
│   │
│   ├── scripts/                      # 脚本文件
│   │   ├── migrate.go               # 数据库迁移脚本
│   │   └── seed.go                  # 数据填充脚本
│   │
│   ├── Dockerfile                   # 生产环境Dockerfile
│   ├── Dockerfile.dev               # 开发环境Dockerfile
│   ├── go.mod                       # Go模块定义
│   ├── go.sum                       # Go模块校验
│   └── .air.toml                    # 热重载配置
│
├── frontend/                        # 前端Vue项目
│   ├── public/                      # 静态资源
│   │   ├── index.html
│   │   └── favicon.ico
│   │
│   ├── src/                         # 源码目录
│   │   ├── assets/                  # 资源文件
│   │   │   ├── styles/              # 样式文件
│   │   │   │   ├── global.css
│   │   │   │   └── variables.css
│   │   │   └── images/              # 图片资源
│   │   │
│   │   ├── components/              # 组件
│   │   │   ├── common/              # 通用组件
│   │   │   │   ├── Header.vue
│   │   │   │   ├── Footer.vue
│   │   │   │   └── Loading.vue
│   │   │   ├── auth/                # 认证相关组件
│   │   │   │   ├── LoginForm.vue
│   │   │   │   └── RegisterForm.vue
│   │   │   ├── domain/              # 域名管理组件
│   │   │   │   ├── DomainList.vue
│   │   │   │   └── DomainForm.vue
│   │   │   ├── email/               # 邮箱管理组件
│   │   │   │   ├── EmailList.vue
│   │   │   │   ├── EmailForm.vue
│   │   │   │   └── EmailDetail.vue
│   │   │   └── message/             # 邮件相关组件
│   │   │       ├── MessageList.vue
│   │   │       └── MessageDetail.vue
│   │   │
│   │   ├── views/                   # 页面视图
│   │   │   ├── Home.vue
│   │   │   ├── Login.vue
│   │   │   ├── Register.vue
│   │   │   ├── Dashboard.vue
│   │   │   ├── Domains.vue
│   │   │   ├── Emails.vue
│   │   │   └── Messages.vue
│   │   │
│   │   ├── stores/                  # Pinia状态管理
│   │   │   ├── auth.ts
│   │   │   ├── domain.ts
│   │   │   ├── email.ts
│   │   │   └── message.ts
│   │   │
│   │   ├── api/                     # API接口
│   │   │   ├── auth.ts
│   │   │   ├── domain.ts
│   │   │   ├── email.ts
│   │   │   ├── message.ts
│   │   │   └── request.ts           # Axios配置
│   │   │
│   │   ├── router/                  # 路由配置
│   │   │   └── index.ts
│   │   │
│   │   ├── types/                   # TypeScript类型定义
│   │   │   ├── auth.ts
│   │   │   ├── domain.ts
│   │   │   ├── email.ts
│   │   │   └── message.ts
│   │   │
│   │   ├── utils/                   # 工具函数
│   │   │   ├── helpers.ts
│   │   │   ├── validators.ts
│   │   │   └── constants.ts
│   │   │
│   │   ├── App.vue                  # 根组件
│   │   └── main.ts                  # 应用入口
│   │
│   ├── package.json                 # 依赖配置
│   ├── package-lock.json            # 依赖锁定文件
│   ├── vite.config.ts               # Vite配置
│   ├── tsconfig.json                # TypeScript配置
│   ├── tsconfig.node.json           # Node.js TypeScript配置
│   └── .env                         # 前端环境变量
│
├── docs/                            # 项目文档
│   ├── 开发计划.md                   # 开发计划文档（原始）
│   ├── 临时邮箱系统开发计划.md         # 开发计划文档（详细）
│   ├── api.md                       # API文档
│   ├── deployment.md                # 部署文档
│   └── development.md               # 开发指南
│
├── scripts/                         # 项目脚本
│   ├── setup.sh                     # 环境初始化脚本
│   ├── build.sh                     # 构建脚本
│   └── deploy.sh                    # 部署脚本
│
└── deploy/                          # 部署相关文件
    ├── k8s/                         # Kubernetes配置
    ├── nginx/                       # Nginx配置
    └── ssl/                         # SSL证书
```

### 目录结构特点

#### 后端架构
- **分层架构**：采用经典的分层架构（API层、应用层、领域层、基础设施层）
- **领域驱动**：按业务领域组织代码（用户、域名、邮箱、邮件）
- **数据库抽象**：支持SQLite/PostgreSQL多数据库切换
- **依赖倒置**：通过接口实现依赖倒置，便于测试和扩展

#### 前端架构
- **组件化**：按功能领域组织组件和页面
- **状态管理**：使用Pinia进行集中状态管理
- **类型安全**：完整的TypeScript类型定义
- **API抽象**：统一的API接口管理

#### 开发便利性
- **热重载**：前后端都支持开发时热重载
- **Docker集成**：开发和生产环境Docker配置
- **脚本自动化**：提供各种便利脚本
- **文档完善**：完整的项目文档体系

---

*此开发计划为临时邮箱系统的详细实施指南，建议根据实际开发情况灵活调整。* 